- https://github.com/zendesk/ruby-kafka#semantic-partitioning for fault toletance partition number is usually 2, and for exact message order `partition_key` must be promoted
	- on issue Kafka combined lag due to unprocessible resource blocking the queue: dead-letter queue to the rescue, AMZ SQS has [that](https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-dead-letter-queues.html)
	- Read more: https://www.kai-waehner.de/blog/2022/05/30/error-handling-via-dead-letter-queue-in-apache-kafka/
		- https://www.enterpriseintegrationpatterns.com/DeadLetterChannel.html
		- https://www.enterpriseintegrationpatterns.com/patterns/conversation/ [_Asynchronous Request-Response_](https://www.enterpriseintegrationpatterns.com/patterns/conversation/RequestResponse.html)
			- ![[Pasted image 20221009175504.png]] 
	- https://github.com/zendesk/ruby-kafka/pull/604 Minh made the kafka headers, but he hasn't brought it to the ddbus; he literally ref the ddb implementation to that PR, what a coincidence!
- https://github.com/zendesk/ruby-kafka/blob/7a97502ce074736281dbf76e75d43995dc0f0c9a/lib/kafka/client.rb#L92 SASL vs SSL
	- https://developer.confluent.io/learn-kafka/security/authentication-ssl-and-sasl-ssl/ simple authentication & security layer
		- [you must specify one of the four authentication methods supported by Apache Kafka: GSSAPI, Plain, SCRAM-SHA-256/512, or OAUTHBEARER](https://developer.confluent.io/learn-kafka/security/authentication-ssl-and-sasl-ssl/#:~:text=you%20must%20specify%20one%20of%20the%20four%20authentication%20methods%20supported%20by%20Apache%20Kafka%3A%20GSSAPI%2C%20Plain%2C%20SCRAM%2DSHA%2D256/512%2C%20or%20OAUTHBEARER)
		- "SSL is ideally suited for cloud environments while SSL-SASL makes sense for enterprises that already have an authentication server"
- https://github.com/obsidiandynamics/goharvest transactional outbox with Kafka, the outbox table rows are having prefix "kafka_"
	- it ran `reaper` CDC adapter as a **standalone** process, so we can configure reaper to hook to any running DB with precise config as below
		- dataSource: host=localhost port=5432 user=postgres password= dbname=postgres sslmode=disable
		- outboxTable: outbox
	- or else, `goharvest` as associated process, but our stack are Ruby not golang \m/, and they recommend `reaper` mode
		- [Ideally, you should deploy `reaper` as a sidecar daemon](https://github.com/obsidiandynamics/goharvest#:~:text=Ideally%2C%20you%20should%20deploy%20reaper%20as%20a%20sidecar%20daemon)
	- ![[Pasted image 20221009201440.png]]
	- look at the transaction scope, yeah
	- "`goharvest` is a complex beast, the end result is dead simple: to publish Kafka messages reliably and atomically, simply write a record to a dedicated **outbox table** in a transaction, alongside any other database changes"
	- https://github.com/obsidiandynamics/goharvest/wiki/Comparison-of-messaging-patterns#:~:text=Causal%20consistency%20captures,causally%20unrelated%20operations.