- The problem of service A -> n sandboxes B -> service C in an async environment (or specifically we can use the world "saga patterns")
	- **Everything is still fine on production**, just corrupted in staging due to the "n sandboxes" as service C receive repeated messages from "n sandboxes". And it's not possible to be idempotent as it has to please "n sandboxes" with N results sending back from C to A.
	- adopt a bus suffix (de facto solution), a way to clarify the boundary between services.
		- (production) ServiceB.Concern.Topic AND (staging) ServiceB.Concern.Topic-sandbox1
			- bus definitions of staging at service A, B and C must be similar for the Concern and Topic
			- can we have more than 1 critical path?
				- seems no, C in real-world has to respond to A somehow, due to the aspect of a saga. If it has to use bus suffix AND is receiving two message from sandbox1 and sandbox2, how come it can be idempotent? See the below figure. The (?) is called twice
				- ![[Screenshot 2023-09-14 at 11.41.10.png]]
				- It is like the first topic should have suffix to avoid coming to B2: `ServiceA.Concern.Topic-sandbox1`. It could be approachable. But the definition of suffix should be down to bus level, not service level.
				- It's a hmm ðŸ¤”
	- [infra] can be fixed with better staging boundaries, so it will be 100% similar to production where "n sandboxes" is just 1 service.
		- However, it turns out to be more complicated. Higher cloud infra cost and also the staging configuration is a huge mess because it depends on specific buses to connect to a specific broker ðŸ‘Ž
		- ![[Screenshot 2023-09-14 at 11.56.46.png]]
		- A concept of Omnibus
	- Setup message headers
		- C can block receiving messages from B or there can be a message interceptor at B to only keep relevant message working with just one MSK with extra [headers](https://www.confluent.io/blog/5-things-every-kafka-developer-should-know/#headers-to-kafka-records)
		- Even this approach has a "just staging" implementation. Not so clean, while not being so bad. Another hmm ðŸ¤”